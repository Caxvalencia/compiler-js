<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Calculator</title>

	<script src="Stack.js"></script>
	<script src="Lex.js"></script>
	<script src="Syntax.js"></script>
</head>

<body>

	<input type="text" name="sourceCode" id="sourceCode" value="5 + 5 * (5+5)" />
	<input type="button" value="Compile" id="compile">

<script>
// csLexer.AddTokenRule( @"\s+", "ESPACIO", true );           
// csLexer.AddTokenRule( @"\b[_a-zA-Z][\w]*\b", "IDENTIFICADOR" );
// csLexer.AddTokenRule( "\".*?\"", "CADENA" );
// csLexer.AddTokenRule( @"'\\.'|'[^\\]'", "CARACTER" );
// csLexer.AddTokenRule( "//[^\r\n]*", "COMENTARIO1");
// csLexer.AddTokenRule( "/[*].*?[*]/", "COMENTARIO2" );
// csLexer.AddTokenRule( @"\d*\.?\d+", "NUMERO");              
// csLexer.AddTokenRule( @"[\(\)\{\}\[\];,]", "DELIMITADOR" );
// csLexer.AddTokenRule( @"[\.=\+\-/*%]","OPERADOR" );
// csLexer.AddTokenRule( @">|<|==|>=|<=|!", "COMPARADOR" );

!function( window, undefined ) {
	/**
	 * Analizador Lexico
	 */
	var lexico = {
		// DELIMITERS
		'(': /\(/,
		')': /\)/,
		'{': /\{/,
		'}': /\}/,
		'[': /\[/,
		']': /\]/,

		// OPERATORS
		'+': /\+/,
		'-': /\-/,
		'*': /\*/,
		'/': /\//,

		'NUMBER': /\-?[0-9]*\.?[0-9]+/
	};

	var grammar = {
		'E': [
			'E + T',
			'T'
		],

		'T': [
			'T * F',
			'F'
		],

		'F': [
			'( E )',
			'NUMBER'
		]
	};


	var btnCompile = document.getElementById( 'compile' ),
		sourceCode = document.getElementById( 'sourceCode' );

	var lexer = new Lex( lexico, { addSymbolTable: [ 'NUMBER', '+', '*', '(', ')' ] });
	var syntax = new Syntax( grammar, lexer );

	btnCompile.addEventListener( 'click', function() {
		lexer.analyze( sourceCode.value );

		showInfo( lexer, syntax );
		
		syntax.setTokens( lexer.tokens );
		syntax.setSymbolTable( lexer.symbolTable );
		
		if( syntax.analyze() ) {
			console.log( "Analyzed successfuly" )
		}
	});

	btnCompile.click();

	function showInfo( lexer, syntax ) {
		var parsingTable = {};
		for( let state in syntax.parsingTable ) {
			parsingTable[ state ] = {};
			
			for( let state2 in syntax.parsingTable[ state ] ) {
				parsingTable[ state ][ state2 ] = syntax.parsingTable[ state ][ state2 ];
				parsingTable[ state ][ state2 ] = parsingTable[ state ][ state2 ].join( "," );
			}
		}

		for( let state = 0; state < syntax.states.length; state++ ) {
			// console.log( 'state: ' + state );
			// console.table( syntax.getState( state ).data );
			// console.log( syntax.getState( state ) );
		}

		console.info( 'PARSING TABLE' );
		console.table( parsingTable );

		console.info( 'TOKENS' );
		console.table( lexer.tokens );

		console.info( 'SYMBOL TABLE' );
		console.table( lexer.symbolTable );
	}

}( window );
	</script>
</body>
</html>